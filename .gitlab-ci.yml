variables:
  POSTGRES_DB: imcr_test
  DATABASE_URL: postgis://postgres:@postgresql/imcr_test
  REDIS_URL: "redis://redis:6379"

pronto:
  stage: test
  image: registry.gitlab.com/itsmycargo/docker-images/pronto:latest
  script:
    - scripts/pronto

rspec:
  stage: test
  image: docker:stable
  services:
    - docker:dind
    - mdillon/postgis
    - redis
  script:
    - apk add --no-cache python py2-pip
    - pip install --no-cache-dir docker-compose
    - docker-compose -f docker-compose.test.yml run --rm api bin/rspec
