variables:
  BUNDLE_GITLAB__COM: "gitlab-ci-token:${CI_JOB_TOKEN}"

pronto:
  stage: test
  tags:
    - itsmycargo
  image: eu.gcr.io/itsmycargo-main/pronto:stable
  script:
    - scripts/pronto

charge_calculator:
  stage: test
  tags:
    - itsmycargo
  image: ruby:2.5
  variables:
    SPEC_OPTS: "--format RspecJunitFormatter --out rspec.xml --format Fuubar --color"
  script:
    - "cd lib/charge_calculator; bundle; bundle exec rspec"
  artifacts:
    reports:
      junit: lib/charge_calculator/rspec.xml

rspec:
  stage: test
  tags:
    - itsmycargo
  image: eu.gcr.io/itsmycargo-main/base:stable
  services:
    - mdillon/postgis
  variables:
    POSTGRES_DB: imcr_test
    DATABASE_URL: postgis://postgres:@localhost/imcr_test
  script:
    - scripts/ci-build.sh bin/rspec
  artifacts:
    reports:
      junit: rspec.xml

jest:
  stage: test
  tags:
    - itsmycargo
  image: eu.gcr.io/itsmycargo-main/base:stable

  script:
    - cd client
    - npm install
    - npm test
